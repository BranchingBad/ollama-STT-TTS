# config.ini - Improved Configuration

[Models]
ollama_model = llama3
whisper_model = small.en
wakeword_model_path = models/jarvis_v2.onnx
piper_model_path = models/en_US-lessac-medium.onnx
ollama_host = http://localhost:11434

[Functionality]
wakeword = hey jarvis

# IMPROVEMENT #1: Raise threshold to reduce false positives
# Your logs show detections at 0.66, 0.72 which are borderline
# Raising to 0.40 will require more confident detections
wakeword_threshold = 0.40

# IMPROVEMENT #2: Reduce VAD aggressiveness for better silence detection
# Level 2 may be too aggressive, causing it to miss speech pauses
# Level 1 is more forgiving and should prevent premature cutoffs
vad_aggressiveness = 1

# IMPROVEMENT #3: Reduce silence threshold for faster response
# 0.7s is quite long - reducing to 0.5s will make it feel more responsive
# This should prevent hitting the 15s max timeout so often
silence_seconds = 0.5

# Keep timeout reasonable
listen_timeout = 5.0

# IMPROVEMENT #4: Reduce pre-buffer for cleaner audio capture
# 600ms is quite long and may include ambient noise
pre_buffer_ms = 300

# System prompt - keep responses concise for voice
system_prompt = You are a witty, intelligent voice assistant. Your brainpower is vast, but your output channel is tiny. All responses must be highly compressed: just one or two clever, concise sentences. Be witty, be accurate, be brief. No filler.

# Audio device indices (None = use default)
device_index = None
piper_output_device_index = 0
gain = 0.8 # Mic input gain. 1.0 = no change. Lower to prevent clipping.

# Maximum words allowed in a command
max_words_per_command = 80

# IMPROVEMENT #5: Reduce max phrase duration
# Your logs show ALL recordings hitting 15s timeout
# Reducing to 10s will force faster speech completion
max_phrase_duration = 10.0

# Whisper configuration
whisper_device = cpu
whisper_compute_type = int8

# IMPROVEMENT #6: Make Whisper thresholds slightly stricter
# Current settings are very lenient (-1.3, 0.75)
# This causes acceptance of low-quality transcriptions
# Tightening slightly should improve accuracy
whisper_avg_logprob = -1.0
whisper_no_speech_prob = 0.65

# Chat history settings
max_history_tokens = 2048

# IMPROVEMENT #7: Increase audio buffer size further
# You're still seeing potential dropouts
audio_buffer_size = 400

# Trim wake word from transcription (recommended)
trim_wake_word = true

[Performance]
# Force garbage collection every N conversations
gc_interval = 10

# Enable memory profiling in debug mode (adds overhead)
memory_profiling = false